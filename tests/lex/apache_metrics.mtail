




counter
http_connections_aborted_total
by
server_port
handler
method
code
protocol
connection_status

counter
http_connections_closed_total
by
server_port
handler
method
code
protocol
connection_status


counter
http_request_size_bytes_total
by
server_port
handler
method
code
protocol

counter
http_response_size_bytes_total
by
server_port
handler
method
code
protocol


histogram
http_request_duration_seconds
by
server_port
handler
method
code
protocol
buckets
0.005
0.01
0.025
0.05
0.1
0.25
0.5
1
2.5
5
10
15


/^/
+

/(?P<server_port>\S+) /
+

/(?P<handler>\S+) /
+

/(?P<method>[A-Z]+) /
+

/(?P<code>\d{3}) /
+

/(?P<protocol>\S+) /
+

/(?P<connection_status>conn=.) /
+

/(?P<time_us>\d+) /
+

/(?P<sent_bytes>\d+) /
+

/(?P<received_bytes>\d+) /
+

/(?P<keepalives>\d+)/
+

/$/
{




http_request_duration_seconds
[
$server_port
]
[
$handler
]
[
$method
]
[
$code
]
[
$protocol
]
=
$time_us
/
1000000.0




http_response_size_bytes_total
[
$server_port
]
[
$handler
]
[
$method
]
[
$code
]
[
$protocol
]
+=
$sent_bytes

http_request_size_bytes_total
[
$server_port
]
[
$handler
]
[
$method
]
[
$code
]
[
$protocol
]
+=
$received_bytes






/ conn=X /
{

http_connections_aborted_total
[
$server_port
]
[
$handler
]
[
$method
]
[
$code
]
[
$protocol
]
[
$connection_status
]
++

}


/ conn=- /
{

http_connections_closed_total
[
$server_port
]
[
$handler
]
[
$method
]
[
$code
]
[
$protocol
]
[
$connection_status
]
++

}

}

